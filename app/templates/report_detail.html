{% extends "base.html" %}

{% block title %}–†–µ–ø–æ—Ä—Ç #{{ report.id }}{% endblock %}

{% block extra_css %}
<style>
    .report-detail {
        max-width: 1000px;
        margin: 2rem auto;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px var(--shadow);
    }
    
    .report-header {
        background: linear-gradient(135deg, var(--blue-ice), var(--green-lime));
        color: white;
        padding: 2rem;
        text-align: center;
    }
    
    .report-status {
        display: inline-block;
        padding: 0.5rem 1.5rem;
        border-radius: 25px;
        font-weight: 600;
        margin-bottom: 1rem;
    }
    
    .report-content {
        padding: 2rem;
    }
    
    .report-image-container {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .report-image {
        max-width: 100%;
        border-radius: 12px;
        box-shadow: 0 4px 20px var(--shadow);
    }
    
    .report-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }
    
    .info-item {
        padding: 1.5rem;
        background: #f5f5f5;
        border-radius: 12px;
    }
    
    .info-label {
        color: #757575;
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
    }
    
    .info-value {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--graphite);
    }
    
    .report-map {
        height: 300px;
        border-radius: 12px;
        margin: 2rem 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="report-detail">
        <div class="report-header">
            <div class="report-status" style="background: {{ 'rgba(255,255,255,0.3)' }};">
                {{ '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ' if report.status == 'confirmed' else '‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ' if report.status == 'pending' else 'üéâ –£–±—Ä–∞–Ω–æ' if report.status == 'cleaned' else '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ' }}
            </div>
            <h1>–†–µ–ø–æ—Ä—Ç #{{ report.id }}</h1>
            <p>{{ report.district or '–ê–ª–º–∞—Ç—ã' }} ‚Ä¢ {{ report.created_at.strftime('%d %B %Y, %H:%M') }}</p>
        </div>
        
        <div class="report-content">
            <!-- Main Image -->
            <div class="report-image-container">
                <img src="{{ report.photo_path | report_photo_url }}" 
                     class="report-image" 
                     alt="Report photo">
            </div>
            
            <!-- Info Grid -->
            <div class="report-info-grid">
                <div class="info-item">
                    <div class="info-label">–ê–≤—Ç–æ—Ä</div>
                    <div class="info-value">{{ report.author.username if report.author and not report.author.is_anonymous_display else '–ê–Ω–æ–Ω–∏–º' }}</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">AI –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å</div>
                    <div class="info-value" style="color: var(--green-lime);">{{ (report.ai_confidence * 100) | round }}%</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è</div>
                    <div class="info-value">
                        {% set category = report.report_category or report.trash_type or 'trash' %}
                        {% if category == 'trash' %}üóëÔ∏è –ú—É—Å–æ—Ä
                        {% elif category == 'vandalism' %}üé® –í–∞–Ω–¥–∞–ª–∏–∑–º
                        {% elif category == 'nature_damage' %}üå≥ –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥—ã
                        {% elif category == 'illegal_dumping' %}üöõ –ù–µ–∑–∞–∫–æ–Ω–Ω—ã–π —Å–±—Ä–æ—Å
                        {% elif category == 'construction_waste' %}üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º—É—Å–æ—Ä
                        {% elif category == 'hazardous_waste' %}‚ö†Ô∏è –û–ø–∞—Å–Ω—ã–µ –æ—Ç—Ö–æ–¥—ã
                        {% else %}üìã –î—Ä—É–≥–æ–µ{% endif %}
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
                    <div class="info-value">üëÅÔ∏è {{ report.views_count }}</div>
                </div>
            </div>
            
            <!-- Description -->
            {% if report.description %}
            <div style="background: #f5f5f5; padding: 1.5rem; border-radius: 12px; margin: 2rem 0;">
                <h3 style="margin: 0 0 1rem 0;">üìù –û–ø–∏—Å–∞–Ω–∏–µ</h3>
                <p style="margin: 0;">{{ report.description }}</p>
            </div>
            {% endif %}
            
            <!-- Address -->
            <div style="background: #e3f2fd; padding: 1.5rem; border-radius: 12px; margin: 2rem 0;">
                <h3 style="margin: 0 0 1rem 0;">üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
                <p style="margin: 0;">
                    <strong>–ê–¥—Ä–µ—Å:</strong> {{ report.address or '–ù–µ —É–∫–∞–∑–∞–Ω' }}<br>
                    <strong>–†–∞–π–æ–Ω:</strong> {{ report.district or '–ù–µ —É–∫–∞–∑–∞–Ω' }}<br>
                    <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> {{ report.latitude }}, {{ report.longitude }}
                </p>
            </div>
            
            <!-- Map -->
            <div id="reportMap" class="report-map"></div>
            
            <!-- Cleaned Image -->
            {% if report.cleaned_photo_path or report.status == 'cleaned' %}
            <div style="margin-top: 2rem;">
                <h3>‚ú® –ü–æ—Å–ª–µ —É–±–æ—Ä–∫–∏</h3>
                <div class="report-image-container">
                    <img src="{{ report.cleaned_photo_path | cleaned_photo_url }}" 
                         class="report-image" 
                         alt="Cleaned photo">
                </div>
                <p style="text-align: center; color: #757575;">
                    –£–±—Ä–∞–Ω–æ {{ report.cleaned_at.strftime('%d %B %Y') if report.cleaned_at else '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞' }}
                </p>
            </div>
            {% endif %}
            
            <!-- Actions -->
            <div style="margin-top: 2rem; text-align: center;">
                <button class="btn btn-primary" onclick="upvoteReport()">
                    üëç –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å ({{ report.upvotes }})
                </button>
                <a href="{{ url_for('main.index') }}" class="btn btn-outline">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ä—Ç–µ</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize map
    const map = L.map('reportMap').setView([{{ report.latitude }}, {{ report.longitude }}], 15);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);
    
    // Add marker
    const icon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #E53935; width: 30px; height: 30px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>',
        iconSize: [30, 30]
    });
    
    L.marker([{{ report.latitude }}, {{ report.longitude }}], { icon }).addTo(map);
    
    // Upvote function
    async function upvoteReport() {
        try {
            const response = await fetch('/reports/{{ report.id }}/upvote', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                location.reload();
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }
</script>
{% endblock %}

